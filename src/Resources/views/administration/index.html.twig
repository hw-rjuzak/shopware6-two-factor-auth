{% extends '@Administration/administration/index.html.twig' %}

{% block administration_login_scripts %}
    <script nonce="{{ cspNonce }}">
        if (!window._swLoginOverrides) {
            window._swLoginOverrides = [];
        }

        window._swLoginOverrides.push(() => {
            sessionStorage.setItem('sw-login-should-reload', 'true');

            Shopware.Application.bootLogin = function () {
                return this.initializeLoginInitializer()
                    .then(() => this.injectPlugin({
                        js: "{{ asset('RuneLaenenTwoFactorAuth'|rl2fa_main_js, '@RuneLaenenTwoFactorAuth') }}"
                    }))
                    .then(() => {
                        if (!this.view) {
                            return Promise.reject();
                        }

                        return this.view.initDependencies();
                    })
                    .then(() => this.createApplicationRoot())
                    .catch((error) => this.createApplicationRootError(error));
            }
        })
    </script>
{% endblock %}
