{"version":3,"file":"index-iHvrXf4n.js","sources":["../../../app/administration/src/component/rl-user-otp/rl-user-otp.html.twig","../../../app/administration/src/component/rl-user-otp/index.js"],"sourcesContent":["{% block rl_user_otp_user_card %}\n    <mt-card :title=\"$tc('rl-2fa.settings.user-detail.title')\"\n             :is-loading=\"isLoading || isLoading2Fa\">\n        <div v-if=\"user && user.customFields && user.customFields.rl_2fa_secret\">\n\n            <sw-alert variant=\"success\"\n                      :title=\"$tc('rl-2fa.settings.user-detail.enabled.title')\"\n                      style=\"margin-bottom: 0;\"\n                      :showIcon=\"true\"\n                      :closable=\"false\">\n                {{ $tc('rl-2fa.settings.user-detail.enabled.description') }}\n\n                <mt-button @click=\"disable2FA\">{{ $tc('rl-2fa.settings.user-detail.enabled.disable') }}</mt-button>\n            </sw-alert>\n        </div>\n        <div v-else-if=\"!generatedSecretUrl\">\n            <sw-alert variant=\"warning\"\n                      :title=\"$tc('rl-2fa.settings.user-detail.not-enabled.title')\"\n                      style=\"margin-bottom: 0;\"\n                      :showIcon=\"true\"\n                      :closable=\"false\">\n                {{ $tc('rl-2fa.settings.user-detail.not-enabled.description') }}\n\n                <sw-button @click=\"generateSecret\">{{ $tc('rl-2fa.settings.user-detail.not-enabled.get-started') }}</sw-button>\n            </sw-alert>\n        </div>\n        <div v-else-if=\"generatedSecretUrl\">\n            <sw-container columns=\"1fr 1fr\">\n                <div class=\"rl-2fa-qr-code\">\n                    <img :src=\"generatedSecretUrl\" />\n                    <span class=\"rl-2fa-qr-code--secret\">{{ generatedSecret }}</span>\n                </div>\n                <div>\n                    <b>{{ $tc('rl-2fa.settings.user-detail.generating.scan-code') }}</b><br />\n                    <br />\n                    {{ $tc('rl-2fa.settings.user-detail.generating.description') }}<br />\n                    <br />\n                    <sw-alert variant=\"error\"\n                              :title=\"$tc('rl-2fa.settings.user-detail.generating.error-title')\"\n                              :showIcon=\"true\"\n                              v-if=\"oneTimePasswordError.length > 0\">\n                        {{ oneTimePasswordError }}\n                    </sw-alert>\n\n                    <mt-text-field label=\"One-time Password\"\n                                   :isInvalid=\"oneTimePasswordError.length > 0\"\n                                   v-model:value=\"oneTimePassword\"\n                                   autocomplete=\"one-time-code\"/>\n\n                    <mt-button @click=\"validateAndSaveOneTimePassword\">\n                        {{ $tc('rl-2fa.settings.user-detail.generating.validate-save') }}\n                    </mt-button>\n                </div>\n            </sw-container>\n        </div>\n    </mt-card>\n{% endblock %}\n","import template from './rl-user-otp.html.twig';\nimport './rl-user-otp.scss';\n\n/**\n * @component-example\n * <rl-user-otp :user=\"user\" :isLoading=\"isLoading\" :onSave=\"onSave\"></rl-user-otp>\n */\nexport default {\n    template,\n\n    inject: ['rl2faService'],\n\n    props: {\n        user: {\n            type: Object,\n            required: true,\n        },\n        isLoading: {\n            type: Boolean,\n            required: true,\n        },\n        onSave: {\n            type: Function,\n            required: true,\n        },\n    },\n\n    data() {\n        return {\n            httpClient: null,\n            isLoading2Fa: false,\n            generatedSecret: null,\n            generatedSecretUrl: null,\n            oneTimePassword: '',\n            oneTimePasswordError: '',\n        };\n    },\n\n    created() {\n        this.syncService = Shopware.Service('syncService');\n        this.httpClient = this.syncService.httpClient;\n    },\n\n    methods: {\n        generateSecret() {\n            this.isLoading2Fa = true;\n\n            this.rl2faService.getSecret(this.user.username).then((response) => {\n                this.isLoading2Fa = false;\n                this.generatedSecret = response.secret;\n                this.generatedSecretUrl = response.qrUrl;\n            });\n        },\n\n        validateAndSaveOneTimePassword() {\n            this.isLoading2Fa = true;\n\n            this.rl2faService.validateSecret(this.generatedSecret, this.oneTimePassword).then((response) => {\n                this.isLoading2Fa = false;\n                if (response.status === 'OK') {\n                    this.saveOneTimePassword();\n                }\n            }).catch((error) => {\n                this.isLoading2Fa = false;\n                this.oneTimePasswordError = error.response.data.error;\n            });\n        },\n\n        saveOneTimePassword() {\n            if (!this.user.customFields) {\n                this.$set(this.user, 'customFields', {});\n            }\n\n            this.user.customFields.rl_2fa_secret = this.generatedSecret;\n            this.onSave();\n        },\n\n        disable2FA() {\n            if (!this.user.customFields) {\n                this.$set(this.user, 'customFields', {});\n            }\n\n            this.user.customFields.rl_2fa_secret = '';\n            this.onSave();\n        },\n    },\n};\n"],"names":["template","index","response","error"],"mappings":"AAAA,MAAeA,EAAA,4xDCOAC,EAAA,CACX,SAAAD,EAEA,OAAQ,CAAC,cAAc,EAEvB,MAAO,CACH,KAAM,CACF,KAAM,OACN,SAAU,EACb,EACD,UAAW,CACP,KAAM,QACN,SAAU,EACb,EACD,OAAQ,CACJ,KAAM,SACN,SAAU,EACb,CACJ,EAED,MAAO,CACH,MAAO,CACH,WAAY,KACZ,aAAc,GACd,gBAAiB,KACjB,mBAAoB,KACpB,gBAAiB,GACjB,qBAAsB,EACzB,CACJ,EAED,SAAU,CACN,KAAK,YAAc,SAAS,QAAQ,aAAa,EACjD,KAAK,WAAa,KAAK,YAAY,UACtC,EAED,QAAS,CACL,gBAAiB,CACb,KAAK,aAAe,GAEpB,KAAK,aAAa,UAAU,KAAK,KAAK,QAAQ,EAAE,KAAME,GAAa,CAC/D,KAAK,aAAe,GACpB,KAAK,gBAAkBA,EAAS,OAChC,KAAK,mBAAqBA,EAAS,KACnD,CAAa,CACJ,EAED,gCAAiC,CAC7B,KAAK,aAAe,GAEpB,KAAK,aAAa,eAAe,KAAK,gBAAiB,KAAK,eAAe,EAAE,KAAMA,GAAa,CAC5F,KAAK,aAAe,GAChBA,EAAS,SAAW,MACpB,KAAK,oBAAqB,CAE9C,CAAa,EAAE,MAAOC,GAAU,CAChB,KAAK,aAAe,GACpB,KAAK,qBAAuBA,EAAM,SAAS,KAAK,KAChE,CAAa,CACJ,EAED,qBAAsB,CACb,KAAK,KAAK,cACX,KAAK,KAAK,KAAK,KAAM,eAAgB,CAAA,CAAE,EAG3C,KAAK,KAAK,aAAa,cAAgB,KAAK,gBAC5C,KAAK,OAAQ,CAChB,EAED,YAAa,CACJ,KAAK,KAAK,cACX,KAAK,KAAK,KAAK,KAAM,eAAgB,CAAA,CAAE,EAG3C,KAAK,KAAK,aAAa,cAAgB,GACvC,KAAK,OAAQ,CAChB,CACJ,CACL"}