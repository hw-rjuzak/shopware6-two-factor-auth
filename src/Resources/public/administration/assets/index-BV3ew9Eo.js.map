{"version":3,"file":"index-BV3ew9Eo.js","sources":["../../../app/administration/src/override/sw-login/view/sw-login-login/sw-login-login.html.twig","../../../app/administration/src/override/sw-login/view/sw-login-login/index.js"],"sourcesContent":["{% block sw_login_login %}\n\n    <div v-if=\"!showOtpForm\">\n        {% parent %}\n    </div>\n    <div v-else>\n        <form class=\"sw-login-login sw-login-login-otp\" @submit.prevent=\"loginUserWithPasswordAndOtp\">\n            <h2 class=\"sw-login__content-headline\">{{ $tc('sw-login.index.headlineForm') }}</h2>\n\n            <mt-text-field\n                v-autofocus\n                v-model=\"otp\"\n                label=\"One-time password\"\n                required\n                autocomplete=\"one-time-code\">\n            </mt-text-field>\n\n            <div class=\"sw-login__submit\">\n                <mt-button\n                    :disabled=\"otp.length != 6 || password.length <= 0 || username.length <= 0\"\n                    class=\"sw-login__login-action\"\n                    variant=\"primary\">\n                    {{ $tc('sw-login.index.buttonLogin') }}\n                </mt-button>\n            </div>\n        </form>\n    </div>\n{% endblock %}\n","import template from './sw-login-login.html.twig';\n\nconst {Context, Application} = Shopware;\n\nexport default {\n    template,\n\n    data() {\n        return {\n            rememberOtpPassword: '',\n            showOtpForm: false,\n            otp: '',\n        };\n    },\n\n    methods: {\n        loginUserWithPasswordAndOtp() {\n            this.$emit('is-loading');\n\n            return this.loginWithOtp(this.username, this.password, this.otp)\n                .then(() => {\n                    this.handleLoginSuccess();\n                    this.$emit('is-not-loading');\n                })\n                .catch((response) => {\n                    this.password = '';\n                    this.otp = '';\n                    this.showOtpForm = false;\n\n                    this.handleLoginError(response);\n                    this.$emit('is-not-loading');\n                });\n        },\n\n        loginWithOtp(user, pass, otp) {\n            return Application.getContainer('init').httpClient.post('/oauth/token', {\n                grant_type: 'password',\n                client_id: 'administration',\n                scopes: 'write',\n                username: user,\n                password: pass,\n                rl_2fa_otp: otp,\n            }, {\n                baseURL: Context.api.apiPath,\n            }).then((response) => {\n                const auth = this.loginService.setBearerAuthentication({\n                    access: response.data.access_token,\n                    refresh: response.data.refresh_token,\n                    expiry: response.data.expires_in,\n                });\n\n                window.localStorage.setItem('redirectFromLogin', 'true');\n\n                return auth;\n            });\n        },\n\n        loginUserWithPassword() {\n            this.rememberOtpPassword = this.password;\n            this.$super('loginUserWithPassword');\n        },\n\n        handleLoginError(error) {\n            if (error.response.data.errors[0].detail !== 'request-otp') {\n                this.$super('handleLoginError', error);\n                return;\n            }\n\n            this.password = this.rememberOtpPassword;\n            this.showOtpForm = true;\n        },\n    },\n};\n"],"names":["template","Context","Application","index","response","user","pass","otp","auth","error"],"mappings":"AAAA,MAAeA,EAAA,yoBCET,CAAC,QAAAC,EAAS,YAAAC,CAAW,EAAI,SAEhBC,EAAA,CACX,SAAAH,EAEA,MAAO,CACH,MAAO,CACH,oBAAqB,GACrB,YAAa,GACb,IAAK,EACR,CACJ,EAED,QAAS,CACL,6BAA8B,CAC1B,YAAK,MAAM,YAAY,EAEhB,KAAK,aAAa,KAAK,SAAU,KAAK,SAAU,KAAK,GAAG,EAC1D,KAAK,IAAM,CACR,KAAK,mBAAoB,EACzB,KAAK,MAAM,gBAAgB,CAC9B,CAAA,EACA,MAAOI,GAAa,CACjB,KAAK,SAAW,GAChB,KAAK,IAAM,GACX,KAAK,YAAc,GAEnB,KAAK,iBAAiBA,CAAQ,EAC9B,KAAK,MAAM,gBAAgB,CAC/C,CAAiB,CACR,EAED,aAAaC,EAAMC,EAAMC,EAAK,CAC1B,OAAOL,EAAY,aAAa,MAAM,EAAE,WAAW,KAAK,eAAgB,CACpE,WAAY,WACZ,UAAW,iBACX,OAAQ,QACR,SAAUG,EACV,SAAUC,EACV,WAAYC,CAC5B,EAAe,CACC,QAASN,EAAQ,IAAI,OACrC,CAAa,EAAE,KAAMG,GAAa,CAClB,MAAMI,EAAO,KAAK,aAAa,wBAAwB,CACnD,OAAQJ,EAAS,KAAK,aACtB,QAASA,EAAS,KAAK,cACvB,OAAQA,EAAS,KAAK,UAC1C,CAAiB,EAED,cAAO,aAAa,QAAQ,oBAAqB,MAAM,EAEhDI,CACvB,CAAa,CACJ,EAED,uBAAwB,CACpB,KAAK,oBAAsB,KAAK,SAChC,KAAK,OAAO,uBAAuB,CACtC,EAED,iBAAiBC,EAAO,CACpB,GAAIA,EAAM,SAAS,KAAK,OAAO,CAAC,EAAE,SAAW,cAAe,CACxD,KAAK,OAAO,mBAAoBA,CAAK,EACrC,MAChB,CAEY,KAAK,SAAW,KAAK,oBACrB,KAAK,YAAc,EACtB,CACJ,CACL"}